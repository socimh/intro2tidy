<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>tidyverse 入门 - 8&nbsp; dplyr 统计</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./dplyr-group.html" rel="next">
<link href="./dplyr-mutate.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="切换侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./dplyr-skim.html">dplyr 基础</a></li><li class="breadcrumb-item"><a href="./dplyr-stat.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">dplyr 统计</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="切换侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">tidyverse 入门</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./tidyverse-入门.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./tidyverse-入门.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R 语言简介</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tibble.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">tibble 数据</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">dplyr 基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-skim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">dplyr 浏览</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-sort.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">dplyr 排序</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-pipe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">magrittr 管道</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">dplyr 选取或删除</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-mutate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">dplyr 更改或新建</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-stat.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">dplyr 统计</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-group.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">dplyr 分组</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr-join.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">dplyr 合并</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">本页目录</h2>
   
  <ul>
  <li><a href="#count" id="toc-count" class="nav-link active" data-scroll-target="#count"><span class="header-section-number">8.1</span> <code>count()</code></a></li>
  <li><a href="#tab-和-tab1" id="toc-tab-和-tab1" class="nav-link" data-scroll-target="#tab-和-tab1"><span class="header-section-number">8.2</span> <code>tab()</code> 和 <code>tab1()</code></a></li>
  <li><a href="#summarise" id="toc-summarise" class="nav-link" data-scroll-target="#summarise"><span class="header-section-number">8.3</span> <code>summarise()</code></a></li>
  <li><a href="#summ" id="toc-summ" class="nav-link" data-scroll-target="#summ"><span class="header-section-number">8.4</span> <code>summ()</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">dplyr 统计</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<ul>
<li>类别变量
<ul>
<li><code>count()</code> 计算各类别数量</li>
<li><code>statart::tab()</code> 计算各类别数量、<span style="color:darkred"><strong>百分比、累计百分比</strong></span></li>
<li><code>statart::tab1()</code> 同时列出<span style="color:darkred"><strong>多个</strong></span>变量的上述统计量</li>
</ul></li>
<li>连续变量
<ul>
<li><code>summarise()</code> 统计<span style="color:darkred"><strong>个别</strong></span>统计量</li>
<li><code>statart::summ()</code> 快速生成<span style="color:darkred"><strong>大量</strong></span>变量的<span style="color:darkred"><strong>多个</strong></span>统计量</li>
</ul></li>
</ul>
<section id="count" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="count"><span class="header-section-number">8.1</span> <code>count()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 显示每一类的数量</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cut)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  cut           n
  &lt;ord&gt;     &lt;int&gt;
1 Fair       1610
2 Good       4906
3 Very Good 12082
4 Premium   13791
5 Ideal     21551</code></pre>
</div>
</div>
</section>
<section id="tab-和-tab1" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="tab-和-tab1"><span class="header-section-number">8.2</span> <code>tab()</code> 和 <code>tab1()</code></h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注意
</div>
</div>
<div class="callout-body-container callout-body">
<p>这两个函数来自于我正在开发的 statart 包，暂时只能通过 <code>source()</code> 函数调用。</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在 count() 的基础上，多了很多信息</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab</span>(cut)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  cut           n percent    cum
  &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 Fair       1610    2.98   2.98
2 Good       4906    9.10  12.1 
3 Very Good 12082   22.4   34.5 
4 Premium   13791   25.6   60.0 
5 Ideal     21551   40.0  100   
6 total     53940  100     NA   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 自动转换成列联表</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab</span>(cut, clarity)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  cut          I1   SI2   SI1   VS2   VS1  VVS2  VVS1    IF total
  &lt;chr&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1 Fair        210   466   408   261   170    69    17     9  1610
2 Good         96  1081  1560   978   648   286   186    71  4906
3 Very Good    84  2100  3240  2591  1775  1235   789   268 12082
4 Premium     205  2949  3575  3357  1989   870   616   230 13791
5 Ideal       146  2598  4282  5071  3589  2606  2047  1212 21551
6 total       741  9194 13065 12258  8171  5066  3655  1790 53940</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 同时 tab1() 多个变量</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab1</span>(cut<span class="sc">:</span>clarity)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$cut
# A tibble: 6 × 4
  value         n percent    cum
  &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 Fair       1610    2.98   2.98
2 Good       4906    9.10  12.1 
3 Very Good 12082   22.4   34.5 
4 Premium   13791   25.6   60.0 
5 Ideal     21551   40.0  100   
6 total     53940  100     NA   

$color
# A tibble: 8 × 4
  value     n percent   cum
  &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 D      6775   12.6   12.6
2 E      9797   18.2   30.7
3 F      9542   17.7   48.4
4 G     11292   20.9   69.3
5 H      8304   15.4   84.7
6 I      5422   10.1   94.8
7 J      2808    5.21 100  
8 total 53940  100     NA  

$clarity
# A tibble: 9 × 4
  value     n percent    cum
  &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 I1      741    1.37   1.37
2 SI2    9194   17.0   18.4 
3 SI1   13065   24.2   42.6 
4 VS2   12258   22.7   65.4 
5 VS1    8171   15.1   80.5 
6 VVS2   5066    9.39  89.9 
7 VVS1   3655    6.78  96.7 
8 IF     1790    3.32 100   
9 total 53940  100     NA   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 同时 tab1() 多个变量，并返回成一个数据</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab1</span>(cut<span class="sc">:</span>clarity, <span class="at">.append =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 5
   variable value         n percent    cum
   &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 cut      Fair       1610    2.98   2.98
 2 cut      Good       4906    9.10  12.1 
 3 cut      Very Good 12082   22.4   34.5 
 4 cut      Premium   13791   25.6   60.0 
 5 cut      Ideal     21551   40.0  100   
 6 cut      total     53940  100     NA   
 7 color    D          6775   12.6   12.6 
 8 color    E          9797   18.2   30.7 
 9 color    F          9542   17.7   48.4 
10 color    G         11292   20.9   69.3 
11 color    H          8304   15.4   84.7 
12 color    I          5422   10.1   94.8 
13 color    J          2808    5.21 100   
14 color    total     53940  100     NA   
15 clarity  I1          741    1.37   1.37
16 clarity  SI2        9194   17.0   18.4 
17 clarity  SI1       13065   24.2   42.6 
18 clarity  VS2       12258   22.7   65.4 
19 clarity  VS1        8171   15.1   80.5 
20 clarity  VVS2       5066    9.39  89.9 
21 clarity  VVS1       3655    6.78  96.7 
22 clarity  IF         1790    3.32 100   
23 clarity  total     53940  100     NA   </code></pre>
</div>
</div>
</section>
<section id="summarise" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="summarise"><span class="header-section-number">8.3</span> <code>summarise()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 平均钻石价格</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(price))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `mean(price)`
          &lt;dbl&gt;
1         3933.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定变量名</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">price =</span> <span class="fu">mean</span>(price))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  price
  &lt;dbl&gt;
1 3933.</code></pre>
</div>
</div>
</section>
<section id="summ" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="summ"><span class="header-section-number">8.4</span> <code>summ()</code></h2>
<p>为了解决 <code>summarise()</code> 太原始的问题，我尽可能兼顾简便和实用，设计了一个新的函数 <code>summ()</code>。下面我来演示一些基础功能：</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注意
</div>
</div>
<div class="callout-body-container callout-body">
<p>这个函数来自于我正在开发的 statart 包，暂时只能通过 <code>source()</code> 函数调用。</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 统计 price 的变量类型、非缺失数、类别数、均值、标准差、最小值和最大值</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summ</span>(price)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  variable type      n unique  mean    sd   min   max
  &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
1 price    int   53940  11602 3933. 3989.   326 18823</code></pre>
</div>
</div>
<p>解释一下上面的统计量：</p>
<ul>
<li><code>variable</code> 是变量名</li>
<li><code>type</code> 是变量类型（如变量有单位，则为单位）</li>
<li><code>n</code> 是该变量非缺失值的数量</li>
<li><code>unique</code> 是变量的类别数（有多少个不重复的取值）
<ul>
<li>显然，<code>unique</code> <span class="math inline">\(\leq\)</span> <code>n</code></li>
<li><code>unique</code> 越大，意味着这个变量越“连续”，信息越丰富</li>
<li>比方说，<strong>年龄</strong>一般是0-120之间的某个正整数，而相应<strong>月龄</strong>的数量是年龄的12倍，<strong>日龄</strong>尤甚。所以在这三个变量里，<strong>日龄</strong>一般最平滑、最连续，信息量最大，相应的 <code>unique</code> 数也最大。</li>
</ul></li>
<li><code>mean</code> 是均值</li>
<li><code>sd</code> 是标准差</li>
<li><code>min</code> 是最小值</li>
<li><code>max</code> 是最大值</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 同时统计多个变量</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summ</span>(x<span class="sc">:</span>z)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  variable type      n unique  mean    sd   min   max
  &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 x        dbl   53940    554  5.73 1.12      0  10.7
2 y        dbl   53940    552  5.73 1.14      0  58.9
3 z        dbl   53940    375  3.54 0.706     0  31.8</code></pre>
</div>
</div>
<p>在 x, y, z 这三个维度上，钻石的 z（高度）最小，而 x 和 y 的均值几乎一样。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 展示所有统计量</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summ</span>(x<span class="sc">:</span>z, <span class="at">.detail =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">width =</span> <span class="cn">Inf</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 18
  variable type      n unique miss_n valid_pct   min    q1 median  mean   mad
  &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 x        dbl   53940    554      0         1     0  4.71   5.7   5.73 1.38 
2 y        dbl   53940    552      0         1     0  4.72   5.71  5.73 1.36 
3 z        dbl   53940    375      0         1     0  2.91   3.53  3.54 0.845
     sd    q3   max   iqr  skew kurtosis      se
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1 1.12   6.54  10.7  1.83 0.379   -0.618 0.00483
2 1.14   6.54  58.9  1.82 2.43    91.2   0.00492
3 0.706  4.04  31.8  1.13 1.52    47.1   0.00304</code></pre>
</div>
</div>
<p>可以看到，其实 x 和 y 在四分位数（q1 和 q3）上没有什么差别，但是它们的最大值（max）、偏度（skew）和峰度（kurtosis）上相差很多。我猜想，对于一些不规则的钻石，可能会把短边选为 x，而长边选为 y。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 自己选择一些统计量</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summ</span>(x<span class="sc">:</span>z, <span class="at">.stat =</span> <span class="fu">c</span>(<span class="st">"valid_pct"</span>, <span class="st">"mean"</span>, <span class="st">"se"</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  variable type  valid_pct  mean      se
  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 x        dbl           1  5.73 0.00483
2 y        dbl           1  5.73 0.00492
3 z        dbl           1  3.54 0.00304</code></pre>
</div>
</div>
<p>valid_pct 表示非缺失值的比例，这里为1，说明完全无缺失。se 是标准误，也就是对均值的误差估计。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一次性选择所有变量</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summ</span>(<span class="fu">everything</span>())</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in summ(., everything()): 
      cut, color, clarity are factor variables.
      They are summarised (***), but the statistics may be misleading.
      Consider using `tab1()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   variable   type      n unique     mean       sd   min      max
   &lt;chr&gt;      &lt;chr&gt; &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
 1 carat      dbl   53940    273    0.798    0.474   0.2     5.01
 2 cut***     ord   53940      5    3.90     1.12    1       5   
 3 color***   ord   53940      7    3.59     1.70    1       7   
 4 clarity*** ord   53940      8    4.05     1.65    1       8   
 5 depth      dbl   53940    184   61.7      1.43   43      79   
 6 table      dbl   53940    127   57.5      2.23   43      95   
 7 price      int   53940  11602 3933.    3989.    326   18823   
 8 x          dbl   53940    554    5.73     1.12    0      10.7 
 9 y          dbl   53940    552    5.73     1.14    0      58.9 
10 z          dbl   53940    375    3.54     0.706   0      31.8 </code></pre>
</div>
</div>
<p>请注意，因为 cut, color, clarity 都是定序变量，所以 <code>summ()</code> 它们比较牵强。对它们使用前文的 <code>tab1()</code> 会更为合适。</p>
<!-- 下面我想用一个更复杂的数据来体现 `summ()` 的强大之处。 -->
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 14
$ date      &lt;date&gt; 2024-02-08, 2024-02-07, 2024-02-06, 2024-02-05, 2024-02-04,…
$ time      &lt;dttm&gt; 2024-02-09 11:59:59, 2024-02-09 11:59:58, 2024-02-09 11:59:…
$ duration1 &lt;drtn&gt; 3 hours, 4 hours, 5 hours, 6 hours, 7 hours, 8 hours, 9 hou…
$ duration2 &lt;time&gt; 12:34:56, 12:34:56, 12:34:56, 12:34:56, 12:34:56, 12:34:56,…
$ string    &lt;chr&gt; "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC", "ABC…
$ logical   &lt;lgl&gt; TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, TRUE, FA…
$ unit1     [m] 1 [m], 2 [m], 3 [m], 4 [m], 5 [m], 6 [m], 7 [m], 8 [m], 9 [m],…
$ unit2     [m^2] 1 [m^2], 2 [m^2], 3 [m^2], 4 [m^2], 5 [m^2], 6 [m^2], 7 [m^2…
$ factor    &lt;fct&gt; a, b, a, b, a, b, a, b, a, b, a, b, a, b, a, b, a, b, a, b, …
$ order     &lt;ord&gt; a, b, a, b, a, b, a, b, a, b, a, b, a, b, a, b, a, b, a, b, …
$ double    &lt;dbl&gt; 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, …
$ integer   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ half_miss &lt;dbl&gt; 1, NA, 3, NA, 5, NA, 7, NA, 9, NA, 11, NA, 13, NA, 15, NA, 1…
$ all_miss  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<!-- 通过 `glimpse()` 可以看到，这个数据非常复杂，几乎囊括了常见的各种数据类型。让我们来 `summ()` 一下这个数据： -->
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>complex_tb <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">codebook</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in un[i] &lt;- at$units: number of items to replace is not a multiple of
replacement length

Warning in un[i] &lt;- at$units: number of items to replace is not a multiple of
replacement length</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   variable  type                 n unique
   &lt;chr&gt;     &lt;chr&gt;            &lt;int&gt;  &lt;int&gt;
 1 date      date              1000   1000
 2 time      datetime          1000   1000
 3 duration1 duration [hours]  1000   1000
 4 duration2 time [secs]       1000      1
 5 string    character         1000      1
 6 logical   logical           1000      2
 7 unit1     units [m]         1000   1000
 8 unit2     units [m^2]       1000   1000
 9 factor    factor            1000      2
10 order     ordered           1000      2
11 double    double            1000   1000
12 integer   integer           1000   1000
13 half_miss double             500    500
14 all_miss  double               0      0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>complex_tb <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summ</span>(<span class="fu">everything</span>())</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in summ(., everything()): 
    string is non-numeric.
    Use `tab()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in summ(., everything()): 
      date, time are date or datetime variables.
      Use `summ_date()` or `summ_all()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in summ(., everything()): 
      factor, order are factor variables.
      They are summarised (***), but the statistics may be misleading.
      Consider using `tab1()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in summ(., everything()): 
    all_miss is entirely missing and thus removed.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   variable  type        n unique    mean      sd     min   max
   &lt;chr&gt;     &lt;chr&gt;   &lt;int&gt;  &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 duration1 [hours]  1000   1000   502.  289.        3    1002
 2 duration2 [secs]   1000      1 45296     0     45296   45296
 3 logical   lgl      1000      2     0.5   0.500     0       1
 4 unit1     [m]      1000   1000   500.  289.        1    1000
 5 unit2     [m^2]    1000   1000   500.  289.        1    1000
 6 factor*** fct      1000      2     1.5   0.500     1       2
 7 order***  ord      1000      2     1.5   0.500     1       2
 8 double    dbl      1000   1000    50.0  28.9       0.1   100
 9 integer   int      1000   1000   500.  289.        1    1000
10 half_miss dbl       500    500   500   289.        1     999</code></pre>
</div>
</div>
<!-- 小结一下，可以划分出三大类变量，分别是

- `summ()` 无法统计
  - 无法转换成数值的变量，如 string（建议使用`tab1()`）
  - 日期时间类变量，如 date 和 datetime（建议使用`summ_date()`）
  - 全部缺失的变量，如 all_miss
- `summ()` 可以统计，但结果通常无意义
  - 类别型变量，如 factor 和 order（建议使用`tab1()`）
- `summ()` 可以统计，且结果有意义
  - 数值型变量，如 double 和 integer
  - 含单位的数值变量，如 unit1 和 unit2
  - 时间区间变量，如 duration1 和 duration2
  - 逻辑型变量（虚拟变量），如 logical -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./dplyr-mutate.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">dplyr 更改或新建</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./dplyr-group.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">dplyr 分组</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
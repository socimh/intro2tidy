{
  "hash": "c1c1df5b57b708f4d6c987cfe89be082",
  "result": {
    "markdown": "---\ntheme: united\nlang: zh\ntoc: true\ntoc-depth: 3\ntoc-expand: 2\ntoc-title: 本页目录\nnumber-sections: true\n---\n\n\n\n# dplyr 更改或新建\n\n当你添加一个手机号到通讯录，手机会问你是“新建联系人”还是“添加到已有联系人”。这是两个不同的操作。不过，dplyr 的`mutate()`函数，将它们合二为一了。\n\n-   更改变量名\n    -   `rename()` 重命名\n    -   `rename_with()` 批量重命名[（进阶技巧）]{style=\"color:gray\"}\n-   更改或新建列（变量）\n    -   `mutate()` 更改、新建变量\n    -   `fill()` 就近填充缺失值[（进阶技巧）]{style=\"color:gray\"}\n    -   `replace_na()` 批量替换缺失值[（进阶技巧）]{style=\"color:gray\"}\n    -   `rownames_to_column()` 复制行名称为变量[（进阶技巧）]{style=\"color:gray\"}\n    -   `add_count()` 添加变量频数为新变量[（进阶技巧）]{style=\"color:gray\"}\n    -   `unite()` 合并多个变量为一个[（进阶技巧）]{style=\"color:gray\"}\n    -   `separate()等` 拆分一个变量为多个[（进阶技巧）]{style=\"color:gray\"}\n    -   `add_column()` *手动添加变量*[（几乎不用）]{style=\"color:lightgray\"}\n-   更改或新建行（个案）\n    -   `expand()` 和 `complete()` 根据变量取值的组合扩充个案[（进阶技巧）]{style=\"color:gray\"}\n    -   `add_row()` *手动添加变量*[（几乎不用）]{style=\"color:lightgray\"}\n\n## `rename()`\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(tidyverse)\n\n# 把 price 改名为 price_USD\ndiamonds %>%\n  rename(price_USD = price)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 53,940 x 10\n   carat cut       color clarity depth table price_USD     x     y     z\n   <dbl> <ord>     <ord> <ord>   <dbl> <dbl>     <int> <dbl> <dbl> <dbl>\n 1  0.23 Ideal     E     SI2      61.5    55       326  3.95  3.98  2.43\n 2  0.21 Premium   E     SI1      59.8    61       326  3.89  3.84  2.31\n 3  0.23 Good      E     VS1      56.9    65       327  4.05  4.07  2.31\n 4  0.29 Premium   I     VS2      62.4    58       334  4.2   4.23  2.63\n 5  0.31 Good      J     SI2      63.3    58       335  4.34  4.35  2.75\n 6  0.24 Very Good J     VVS2     62.8    57       336  3.94  3.96  2.48\n 7  0.24 Very Good I     VVS1     62.3    57       336  3.95  3.98  2.47\n 8  0.26 Very Good H     SI1      61.9    55       337  4.07  4.11  2.53\n 9  0.22 Fair      E     VS2      65.1    61       337  3.87  3.78  2.49\n10  0.23 Very Good H     VS1      59.4    61       338  4     4.05  2.39\n# i 53,930 more rows\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\n# 把 x, y, z 分别改名为 size_x, size_y, size_z\ndiamonds %>%\n  rename(\n    size_x = x,\n    size_y = y,\n    size_z = z\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 53,940 x 10\n   carat cut       color clarity depth table price size_x size_y size_z\n   <dbl> <ord>     <ord> <ord>   <dbl> <dbl> <int>  <dbl>  <dbl>  <dbl>\n 1  0.23 Ideal     E     SI2      61.5    55   326   3.95   3.98   2.43\n 2  0.21 Premium   E     SI1      59.8    61   326   3.89   3.84   2.31\n 3  0.23 Good      E     VS1      56.9    65   327   4.05   4.07   2.31\n 4  0.29 Premium   I     VS2      62.4    58   334   4.2    4.23   2.63\n 5  0.31 Good      J     SI2      63.3    58   335   4.34   4.35   2.75\n 6  0.24 Very Good J     VVS2     62.8    57   336   3.94   3.96   2.48\n 7  0.24 Very Good I     VVS1     62.3    57   336   3.95   3.98   2.47\n 8  0.26 Very Good H     SI1      61.9    55   337   4.07   4.11   2.53\n 9  0.22 Fair      E     VS2      65.1    61   337   3.87   3.78   2.49\n10  0.23 Very Good H     VS1      59.4    61   338   4      4.05   2.39\n# i 53,930 more rows\n```\n:::\n:::\n\n\n\n## `mutate()`\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# 新建变量 price_RMB，即换算为人民币，假设汇率为7\ndiamonds %>%\n  mutate(price_RMB = price * 7)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 53,940 x 11\n   carat cut       color clarity depth table price     x     y     z price_RMB\n   <dbl> <ord>     <ord> <ord>   <dbl> <dbl> <int> <dbl> <dbl> <dbl>     <dbl>\n 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43      2282\n 2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31      2282\n 3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31      2289\n 4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63      2338\n 5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75      2345\n 6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48      2352\n 7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47      2352\n 8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53      2359\n 9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49      2359\n10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39      2366\n# i 53,930 more rows\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\n# 更改变量 price，换算为人民币，假设汇率为7\ndiamonds %>%\n  mutate(price = price * 7)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 53,940 x 10\n   carat cut       color clarity depth table price     x     y     z\n   <dbl> <ord>     <ord> <ord>   <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n 1  0.23 Ideal     E     SI2      61.5    55  2282  3.95  3.98  2.43\n 2  0.21 Premium   E     SI1      59.8    61  2282  3.89  3.84  2.31\n 3  0.23 Good      E     VS1      56.9    65  2289  4.05  4.07  2.31\n 4  0.29 Premium   I     VS2      62.4    58  2338  4.2   4.23  2.63\n 5  0.31 Good      J     SI2      63.3    58  2345  4.34  4.35  2.75\n 6  0.24 Very Good J     VVS2     62.8    57  2352  3.94  3.96  2.48\n 7  0.24 Very Good I     VVS1     62.3    57  2352  3.95  3.98  2.47\n 8  0.26 Very Good H     SI1      61.9    55  2359  4.07  4.11  2.53\n 9  0.22 Fair      E     VS2      65.1    61  2359  3.87  3.78  2.49\n10  0.23 Very Good H     VS1      59.4    61  2366  4     4.05  2.39\n# i 53,930 more rows\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\n# 新建变量 size，由 x, y, z 相乘而得（不代表钻石真实体积）\ndiamonds %>%\n  mutate(size = x * y * z)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 53,940 x 11\n   carat cut       color clarity depth table price     x     y     z  size\n   <dbl> <ord>     <ord> <ord>   <dbl> <dbl> <int> <dbl> <dbl> <dbl> <dbl>\n 1  0.23 Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43  38.2\n 2  0.21 Premium   E     SI1      59.8    61   326  3.89  3.84  2.31  34.5\n 3  0.23 Good      E     VS1      56.9    65   327  4.05  4.07  2.31  38.1\n 4  0.29 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63  46.7\n 5  0.31 Good      J     SI2      63.3    58   335  4.34  4.35  2.75  51.9\n 6  0.24 Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48  38.7\n 7  0.24 Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47  38.8\n 8  0.26 Very Good H     SI1      61.9    55   337  4.07  4.11  2.53  42.3\n 9  0.22 Fair      E     VS2      65.1    61   337  3.87  3.78  2.49  36.4\n10  0.23 Very Good H     VS1      59.4    61   338  4     4.05  2.39  38.7\n# i 53,930 more rows\n```\n:::\n:::\n",
    "supporting": [
      "dplyr-mutate_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}